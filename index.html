<!DOCTYPE html>
<html lang="en-US">
<head>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular.js"></script>
    <script src="https://cdn.gitcdn.link/cdn/angular/bower-material/v1.1.12/angular-material.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular-animate.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular-route.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular-aria.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.7.5/angular-messages.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.1/moment.js"></script>
    <script src="https://s3-us-west-2.amazonaws.com/s.cdpn.io/t-114/svg-assets-cache.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-select/0.20.0/select.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/angular-sanitize/1.7.6/angular-sanitize.js"></script>


    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700,400italic">
    <link rel='stylesheet' href='https://cdn.gitcdn.link/cdn/angular/bower-material/v1.1.12/angular-material.css'>
    <link rel='stylesheet' href='https://material.angularjs.org/1.1.12/docs.css'>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-ui-select/0.20.0/select.css">

	<link href="http://code.jquery.com/ui/1.9.0/themes/cupertino/jquery-ui.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.8.5/css/selectize.default.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/3.4.5/select2.css">  

    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.1/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">



    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

	<script src="http://code.jquery.com/jquery-1.8.2.js"></script>
	<script src="http://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>

    <!-- local lib -->
	<script src="lib/jquery.csv.js"></script>
	<script src="lib/angularjs-datatables.js"></script>
	<script src="lib/angularjs-datatables.css"></script>

    <!-- my scripts -->
	<script src="index.js"></script> 
    <link rel="stylesheet" href="styles/style.css">

    <title>Data Downlow</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
     <!--
        IE8 support, see AngularJS Internet Explorer Compatibility http://docs.angularjs.org/guide/ie
        For Firefox 3.6, you will also need to include jQuery and ECMAScript 5 shim
      -->
      <!--[if lt IE 9]>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/es5-shim/2.2.0/es5-shim.js"></script>
        <script>
          document.createElement('ui-select');
          document.createElement('ui-select-match');
          document.createElement('ui-select-choices');
        </script>
      <![endif]-->
    
</head>
<body>
	<div ng-cloak="" class="tabsdemoDynamicHeight" ng-app="app" ng-controller="main"> 
        <div class="container">
            <h2 >Download FBI Data on Bias Crimes</h2>
            <md-content>
                <md-tabs md-dynamic-height="" md-border-bottom="">
                    <md-tab label="search">
                      <md-content class="md-padding">
                        <h1 class="md-display-2">Search Data By</h1>

                            

                            <h2 class="section-title">
                                What 
                                <i class="toggle-open fa {{viewToggles.what? 'fa-minus' : 'fa-plus'}}" 
                                   aria-hidden="true" 
                                   ng-click="toggleOpen('what')"></i>
                            </h2>
                            <div id="what" class="section" ng-show=viewToggles.what>
                                <div class="add-param">
                                    <h3>Bias Description</h3>
                                    <ul ng-show="data.BIAS_DESC.length > 0"> 
                                        <li ng-repeat="item in data.BIAS_DESC track by $index"> {{item}}</li>
                                    </ul>
                                    <ui-select ng-model="buff.BIAS_DESC">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.BIAS_DESC | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                   <!--  <select ng-model="buff.BIAS_DESC" ng-options="item for item in initData.BIAS_DESC">
                                    </select> -->
                                    <button class="btn" ng-click="addParam('BIAS_DESC')">Add</button>
                                    <button class="btn" ng-click="clearParam('BIAS_DESC')">Clear</button>
                                </div>
                                <div class="add-param">
                                    <h3>Offense Name</h3>
                                    <ul ng-show="data.OFFENSE_NAME.length > 0"> 
                                        <li ng-repeat="item in data.OFFENSE_NAME track by $index"> {{item}}</li>
                                    </ul>
                                    <ui-select ng-model="buff.OFFENSE_NAME">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.OFFENSE_NAME | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <!-- <select ng-model="buff.OFFENSE_NAME" ng-options="item for item in initData.OFFENSE_NAME"> -->
                                    </select>
                                    <button class="btn" ng-click="addParam('OFFENSE_NAME')">Add</button>
                                    <button class="btn" ng-click="clearParam('OFFENSE_NAME')">Clear</button>
                                </div>
                            </div>
                            <h2 class="section-title">
                                Where
                                <i class="toggle-open fa {{viewToggles.where? 'fa-minus' : 'fa-plus'}}" 
                                   aria-hidden="true" 
                                   ng-click="toggleOpen('where')"></i>
                            </h2>
                            <div id="where" class="section" ng-show=viewToggles.where>
                                <div class="add-param">
                                    <h3>State Name</h3>
                                    <ul ng-show="data.STATE_NAME.length > 0"> 
                                        <li ng-repeat="item in data.STATE_NAME track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.STATE_NAME">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.STATE_NAME | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                      <!--               <select ng-model="buff.STATE_NAME" ng-options="item for item in initData.STATE_NAME"> -->
                                    </select>
                                    <button class="btn" ng-click="addParam('STATE_NAME')">Add</button>
                                    <button class="btn" ng-click="clearParam('STATE_NAME')">Clear</button>
                                </div>

                                 <!-- this next part works but is super slow. why? it all works though!!! -->
                                <div class="add-param">
                                    <h3>Agency Name</h3>
                                    <ul ng-show="data.PUB_AGENCY_NAME.length > 0"> 
                                        <li ng-repeat="item in data.PUB_AGENCY_NAME track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.PUB_AGENCY_NAME">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.PUB_AGENCY_NAME | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    
                                    
                                    <button class="btn" ng-click="addParam('PUB_AGENCY_NAME')">Add</button>
                                    <button class="btn" ng-click="clearParam('PUB_AGENCY_NAME')">Clear</button>
                                </div>

                                <div class="add-param">
                                    <h3>Location Name</h3>
                                    <ul ng-show="data.LOCATION_NAME.length > 0"> 
                                        <li ng-repeat="item in data.LOCATION_NAME track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.LOCATION_NAME">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.LOCATION_NAME | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <!-- <select ng-model="buff.LOCATION_NAME" ng-options="item for item in initData.LOCATION_NAME"> -->
                                    </select>
                                    <button class="btn" ng-click="addParam('LOCATION_NAME')">Add</button>
                                    <button class="btn" ng-click="clearParam('LOCATION_NAME')">Clear</button>
                                </div>
                                <div class="add-param">
                                    <h3>Agency Type Name</h3>
                                    <ul ng-show="data.AGENCY_TYPE_NAME.length > 0"> 
                                        <li ng-repeat="item in data.AGENCY_TYPE_NAME track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.AGENCY_TYPE_NAME">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.AGENCY_TYPE_NAME | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <!-- <select ng-model="buff.AGENCY_TYPE_NAME" ng-options="item for item in initData.AGENCY_TYPE_NAME"> -->
                                    </select>
                                    <button class="btn" ng-click="addParam('AGENCY_TYPE_NAME')">Add</button>
                                    <button class="btn" ng-click="clearParam('AGENCY_TYPE_NAME')">Clear</button>
                                </div>
                                <div class="add-param">
                                    <h3>Population Group Descrition</h3>
                                    <ul ng-show="data.POPULATION_GROUP_DESC.length > 0"> 
                                        <li ng-repeat="item in data.POPULATION_GROUP_DESC track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.POPULATION_GROUP_DESC">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.POPULATION_GROUP_DESC | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <!-- <select ng-model="buff.POPULATION_GROUP_DESC" ng-options="item for item in initData.POPULATION_GROUP_DESC"> -->
                                    </select>
                                    <button class="btn" ng-click="addParam('POPULATION_GROUP_DESC')">Add</button>
                                    <button class="btn" ng-click="clearParam('POPULATION_GROUP_DESC')">Clear</button>
                                </div>
                            </div>
                            
                            <h2 class="section-title">
                                Who
                                <i class="toggle-open fa {{viewToggles.who? 'fa-minus' : 'fa-plus'}}" 
                                   aria-hidden="true" 
                                   ng-click="toggleOpen('who')"></i>
                            </h2>
                            <div id="who" class="section" ng-show=viewToggles.who>
                                <div class="add-param">
                                    <h3>Victim Types</h3>
                                    <ul ng-show="data.VICTIM_TYPES.length > 0"> 
                                        <li ng-repeat="item in data.VICTIM_TYPES track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.VICTIM_TYPES">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.VICTIM_TYPES | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <!-- <select ng-model="buff.VICTIM_TYPES" ng-options="item for item in initData.VICTIM_TYPES">
                                    </select> -->
                                    <button class="btn" ng-click="addParam('VICTIM_TYPES')">Add</button>
                                    <button class="btn" ng-click="clearParam('VICTIM_TYPES')">Clear</button>
                                </div>
                                <div class="add-param">
                                    <h3>Offender Race</h3>
                                    <ul ng-show="data.OFFENDER_RACE.length > 0"> 
                                        <li ng-repeat="item in data.OFFENDER_RACE track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.OFFENDER_RACE">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.OFFENDER_RACE | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <!-- <select ng-model="buff.OFFENDER_RACE" ng-options="item for item in initData.OFFENDER_RACE"> -->
                                    </select>
                                    <button class="btn" ng-click="addParam('OFFENDER_RACE')">Add</button>
                                    <button class="btn" ng-click="clearParam('OFFENDER_RACE')">Clear</button>
                                </div>

                                <div class="add-param">
                                    <h3>Offender Ethnicity</h3>
                                    <ul ng-show="data.OFFENDER_ETHNICITY.length > 0"> 
                                        <li ng-repeat="item in data.OFFENDER_ETHNICITY track by $index"> {{item}} </li>
                                    </ul>
                                    <ui-select ng-model="buff.OFFENDER_ETHNICITY">
                                        <ui-select-match>
                                            <span ng-bind="$select.selected"></span>
                                        </ui-select-match>
                                        <ui-select-choices repeat="item in (initData.OFFENDER_ETHNICITY | filter: $select.search) track by $index">
                                            <span ng-bind="item"></span>
                                        </ui-select-choices>
                                    </ui-select>
                                    <!-- <select ng-model="buff.OFFENDER_ETHNICITY" ng-options="item for item in initData.OFFENDER_ETHNICITY">
                                    </select> -->
                                    <button class="btn" ng-click="addParam('OFFENDER_ETHNICITY')">Add</button>
                                    <button class="btn" ng-click="clearParam('OFFENDER_ETHNICITY')">Clear</button>
                                </div>
                            </div>
                            

                            

                            <div class="controls">
                                <button class="btn" ng-click="getData()">Get Data</button>
                                <button class="btn" ng-click="reset()">Reset</button>
                            </div>

                        </md-content>
                    </md-tab>
                    <md-tab label="table" ng-disabled="checkData">
                        <md-content class="md-padding">
                            <h1 ng-show="showTable"><a download="data.csv" ng-href="{{ fileName }}">Download Data</a></h1>

                            <table class="table table-striped table-bordered dataTable" ng-rows="data">
                                <thead>
                                    <tr>
                                        <!-- it'd be great if this worked -->
                                        <!-- <th ng-repeat="key in Object.keys(data[0])">{{key}}</th> -->
                                        <th >INCIDENT_ID</th>
                                        <th >INCIDENT_NO</th>
                                        <th>BIAS_DESC</th>
                                        <th>OFFENSE_NAME</th>
                                        <th >DATA_YEAR</th>
                                        <th >INCIDENT_DATE</th>
                                        <th >ORI</th>
                                        <th >PUB_AGENCY_NAME</th>
                                        <th >PUB_AGENCY_UNIT</th>
                                        <th >AGENCY_TYPE_NAME</th>
                                        <th>POPULATION_GROUP_DESC</th>
                                        <th> STATE_NAME</th>
                                        <th >LOCATION_NAME</th>
                                        <th >OFFENDER_ETHNICITY</th>
                                        <th >OFFENDER_RACE</th>

                                        <th >TOTAL_OFFENDER_COUNT</th>
                                        <th >TOTAL_INDIVIDUAL_VICTIMS</th>
                                        <th> VICTIM_COUNT</th>
                                        <th> VICTIM_TYPES: </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-row >
                                        <!-- it'd be great if this worked -->
                                        <!-- <th ng-repeat="key in Object.keys(row)">{{row[key]}}</th> -->
                                        <th>{{row.INCIDENT_ID}}</th>
                                        <th>{{row.INCIDENT_NO}}</th>
                                        <th>{{row.BIAS_DESC}}</th>
                                        <th>{{row.OFFENSE_NAME}}</th>
                                        <th>{{row.DATA_YEAR}}</th>
                                        <th>{{row.INCIDENT_DATE}}</th>
                                        <th>{{row.ORI}}</th>
                                        <th>{{row.PUB_AGENCY_NAME}}</th>
                                        <th>{{row.PUB_AGENCY_UNIT}}</th>
                                        <th>{{row.AGENCY_TYPE_NAME}}</th>
                                        <th>{{row.POPULATION_GROUP_DESC}}</th>
                                        <th>{{row.STATE_NAME}}</th>
                                        <th>{{row.LOCATION_NAME}}</th>
                                        <th>{{row.OFFENDER_ETHNICITY}}</th>
                                        <th>{{row.OFFENDER_RACE}}</th>
                                        <th>{{row.TOTAL_OFFENDER_COUNT}}</th>
                                        <th>{{row.TOTAL_INDIVIDUAL_VICTIMS}}</th>
                                        <th>{{row.VICTIM_COUNT}}</th>
                                        <th>{{row.VICTIM_TYPES}}</th>
                                    </tr>
                                </tbody>
                            </table>
                            
                            <!-- <table ng-show="showTable">
                                <thead>
                                    <tr>
                                        <th ng-repeat="item in data[0]" >{{item}}</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr ng-repeat="row in data.slice(1,data.length)">
                                        <td ng-repeat="item in row track by $index">{{item}}</td>
                                    </tr>
                                </tbody>
                            </table> -->
                        </md-content>
                    </md-tab>
    	            <md-tab label="viz" ng-disabled="vizImplemented">
                        <md-content class="md-padding">
                            <h1 class="md-display-2">Vizualize Data</h1>
                            <p>Working on it</p>
                        </md-content>
                    </md-tab>
                    <md-tab label="about">
                        <md-content class="md-padding">
                            <h1 class="md-display-2">About</h1>
                            <h2>Basics</h2>
                            <div>
                                <p>This tool lets you search and download reports of hate crimes, or crimes motivated by a bias. The reports are from law enforcement agencies around the U.S. who sent the data to the FBI.</p>
                                <p>It is still under development.</p>
                                <p>The data came from <a href="https://crime-data-explorer.fr.cloud.gov/downloads-and-docs">the FBI</a>. 
                                <p>This project set up a sever to host the data and to let users search and filter it with an online interface.</p>
                            </div>
                            <div>
                                <h2>Use</h2>
                                <p>Choose the parameters to search by, click "get data." Then you can view the data in the "table" tab. There, you can also find a link to download the slice of data you selected.</p>
                            </div>
                            <div>
                                <h2>More Backgorund</h2>
                                <p>The reports are part of the Summary Reporting System or National Incident-Based Reporting System. The data covers the years 1991-2017. Not all law enforcement departments these types of reports, and even fewer will have data for all of the years. Caution is warranted when drawing conclusions from this data.</p>
                            </div>
                        </md-content>
                    </md-tab>
                </md-tabs>
            </md-content>
    	</div>
    </div>
</body>


</html>

